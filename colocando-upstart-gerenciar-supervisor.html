<!DOCTYPE html>
<html lang="pt">
<head>
          <title>Jesué Junior</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link type="text/css" rel="stylesheet" href="/theme/css/bootstrap.min.css" />
        <link type="text/css" rel="stylesheet" href="/theme/css/style.css" />
        <link type="text/css" rel="stylesheet" href="/theme/css/pygments.css" />
        <link href='http://fonts.googleapis.com/css?family=Gudea:400,700,400italic|Asap:400,700,400italic' rel='stylesheet' type='text/css'>



    <meta name="tags" content="Linux" />
    <meta name="tags" content="supervisord" />
    <meta name="tags" content="ubuntu" />
    <meta name="tags" content="upstart" />

</head>

<body>
    <div class="bg">
        <div class="wrap">
            <nav id="sidebar">
                <a href="/" id="logo"></a>
                <ul id="menu">
                    <li> <a class="menu-link" href="/pages/about.html">About</a></li>
                    <li> <a class="menu-link" href="/pages/projects.html">Projects</a></li>
                </ul>

                <div class="social">
                    <a target="_blank" href="https://twitter.com/jesuejunior" class="social-link twitter"></a>
                    <a target="_blank" href="http://www.linkedin.com/in/jesuejunior" class="social-link linkedin"></a>
                    <a target="_blank" href="https://plus.google.com/u/0/110593412520623457385/posts" class="social-link googleplus"></a>
                    <a target="_blank" href="https://github.com/jesuejunior" class="social-link github"></a>
                    <a target="_blank" href="https://delicious.com/jesuejunior" class="social-link delicious"></a>
                    <a target="_blank" href="https://www.codeschool.com/users/jesuejunior" class="social-link codeschool"></a>
                </div>
            </nav>
<div id="content" class="">
    <div class="block welcome">
      <header>
        <h2 class="entry-title">
          <a href="/colocando-upstart-gerenciar-supervisor" rel="bookmark"
             title="Permalink to Colocando Upstart para gerenciar o Supervisor">Colocando Upstart para gerenciar o&nbsp;Supervisor</a></h2>
     
      </header>
      <div class="info">
        <abbr class="" title="2013-12-14T03:22:00-02:00">
          Sat 14 December 2013
        </abbr>
        <address class="vcard author">
          By               <a class="url fn" href="/author/jesuejunior.html">jesuejunior</a>
        </address>
      </div><!-- /.post-info -->
      <div class="">
        <p>Depois de um tempo afastado do Blog, estou &nbsp;organizando melhor o uso do
meu tempo, ou seja, em breve estarei criando mais posts que inclusive já
tenho alguns em&nbsp;rascunho.</p>
<p>Hoje faço parte de uma equipe de devOps. Então cada vez utilizo mais
desenvolvimento para resolver problemas de deploy, escalabilidade entre
outros. Baseado nisso, recentemente implementei na receita do Chef para
o <a class="reference external" href="http://upstart.ubuntu.com/">Upstart</a> controlar o <a class="reference external" href="http://supervisord.org/">Supervisord</a>.</p>
<ul class="simple">
<li>&nbsp;Mas o que é o&nbsp;Supervisord?</li>
</ul>
<p>Supervisor é um sistema client /server que permite que seus usuários
possam monitorar e controlar um número de processos que podem ser grupos
de&nbsp;processos.</p>
<ul class="simple">
<li>Mas o que é o&nbsp;Upstart?</li>
</ul>
<p>Upstart é daemon de&nbsp;substituição ao /sbin/init &nbsp;que lida com a
inicialização de tarefas e serviços durante o boot, impedindo-os durante
o desligamento e supervisionando-os enquanto o sistema está funcionando.
E como ele está no nível init (embutido no kernel), seu processo
dificilmente ficará desligado. Por exemplo, caso seu processo apresente
erro e feche o upstart vai tentar reinicia-lo e caso não consiga, vai
continuar tentando no intervalo de tempo&nbsp;pré-configurado.</p>
<p>Pois bem, aqui vou mostrar como implementar manualmente o que já é de
muita ajuda se você precisar de algo controlando um grupo de processos e
não deixando-os&nbsp;morrerem.</p>
<p><span class="caps">OBS</span>: Estou assumindo que o sistema operacional é baseado em&nbsp;Debian</p>
<div class="section" id="parando-e-removendo-o-supervisord-do-boot">
<h2>Parando e removendo o supervisorD do&nbsp;boot</h2>
<div class="highlight"><pre><span class="nv">$ </span>sudo /etc/init.d/supervisord stop
</pre></div>
<div class="highlight"><pre><span class="nv">$ </span>sudo update-rc.d -f supervisor remove
</pre></div>
<p>Este ultimo comando remove o arquivo <strong>/etc/init.d/supervisord</strong> e caso
queira voltar ao modo antigo de troque o <em>remove</em> por <em>enable.</em></p>
</div>
<div class="section" id="criando-um-script-upstart">
<h2>Criando um script&nbsp;Upstart</h2>
<p>Crie um arquivo &nbsp;<strong>/etc/init/supervisor.conf</strong>. &nbsp;Com o seguinte&nbsp;conteudo:</p>
<div class="highlight"><pre>description <span class="s2">&quot;supervisor&quot;</span>

start on runlevel <span class="o">[</span>2345<span class="o">]</span>

stop on runlevel <span class="o">[</span>!2345<span class="o">]</span>

respawn

<span class="nb">exec</span> /usr/local/bin/supervisord --nodaemon --configuration /etc/supervisord.conf
</pre></div>
<p>Perceba que nós estamos usando o mesmo <em>supervisord</em>, logo não há nada
para mudar aqui.&nbsp;hehehe</p>
</div>
<div class="section" id="usando-supervisord-com-upstart">
<h2>usando supervisord com&nbsp;upstart</h2>
<p>Nós podemos iniciar e parar o <strong>supervisord</strong> com os comandos padrões do
<strong>Upstart</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo stop supervisor
</pre></div>
<div class="highlight"><pre><span class="nv">$ </span>sudo start supervisor
</pre></div>
<p>Para verificar o status do&nbsp;<em>supervisor,&nbsp;faça:</em></p>
<div class="highlight"><pre><span class="nv">$ </span>initctl list
</pre></div>
<div class="highlight"><pre><span class="nv">$ </span>initctl status supervisor
</pre></div>
</div>
<div class="section" id="here-we-go">
<h2><span class="caps">HERE</span> <span class="caps">WE</span> <span class="caps">GO</span>!</h2>
<p>Confirmando que o supervisor está sendo executado, os comandos para
gerencia-lo não mudam em nada, continuamos a ter o &nbsp;<strong>supervisorctl</strong>&nbsp; e
podemos ver os processos que ele está controlando, pois continuamos
usando o mesmo arquivo de configuração padrão que fica em
<em>/etc/supervisord.conf.</em></p>
<p>Então é isso, qualquer duvida não deixe de postar nos comentários, será
um prazer&nbsp;ajudar.</p>
</div>

      </div><!-- /.entry-content -->
    </div>
</div>
            <b class="clear"></b>
        </div>
    </div>
    <footer>
        <div class="wrap">
            <span>Desenvolvido por JJ</span>
        </div>
    </footer>
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-31167248-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>